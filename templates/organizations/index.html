{% extends "organizations/organizations-base.html" %}

{% block src-javascript %}
{% load static %}
<script type="text/javascript" src="{% static 'js/organizations/submit.js' %}"></script>
z<script type="text/javascript" src="{% static 'js/organizations/organizations.js' %}"></script>

<!-- Template for organization list -->
<script id="org_list_template" type="text/template">
<tr>
    <td>
        <a href="<%- url %>">
            <%- name %>
        </a>
    </td>
    <td><%= signator %></td>
    <td>
        <a href="mailto:<%- email %>" target="_top">
            <%- email %>
        </a>
    </td>
</tr>
</script>
{% endblock %}

{% block content %}
  <div class="row-extra-padding">
    <div class="col-md-5">

        <!-- Org table -->
        <h2>All Student Body Organizations</h2>
        <form id="org_list_search"
              method="post"
              action="{% url 'generic.api.search_orgs' %}">
            {% csrf_token %}
            <div class="input-group">
                <input id="org_list_search_query"
                       type="text" class="form-control"
                       placeholder="Search organizations by name">
                <span class="input-group-btn">
                    <input class="btn btn-primary" type="submit">
                </span>
            </div>
        </form>
        
        <table class="table table-hover">
            <thead>
            <tr>
                <th>Name</th>
                <th>Signator</th>
                <th>Email</th>
            </tr>
            </thead>
            <tbody id="org-table-container">

            </tbody>
        </table>
        <p>
            <input class="btn btn-primary" type="submit"
                   value="Get Organization List as CSV"
                   onclick="document.location='{% url 'organizations.views.csv_list' %}';"></input>
        </p>

        
    </div> <!-- /. col-md-7 ... -->
    <div class="col-md-7">

	<h2>My Organizations</h2>
        <p>Keep student body autonomy alive and start an organization. Registering
            on SIN allows you register for Funding Poll and submit budgets to
            Finance Committee. The student body votes in Funding Poll at the
            beginning of each semester on which student organizations should
            get priority funding. (Protip: how much money you get depends just
            as much, if not more, on how well thought out a budget you present
            as how much support you have from the student body.) Budgets can be
            submitted to Finance Committee throughout the semester, in the Finance
            app.
        </p>

	{% if user.attended_signator_training %}
        
        <table class="table table-hover">
            <tr>
                <th>Name</th>
                <th>Registered for Funding Poll</th>
                <th colspan=3>Actions</th>

            </tr>
            {% for o in organizations %}
            <tr>
                <td>
                    <a href="{% url 'organizations.views.organization_detail' o.id %}">
                        {{ o.name }}
                    </a>
                </td>
                <td>
                    {% if o.reg_for_fp %}
                    <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                    {% endif %}
                </td>
                <td>
                    <a type="button" class="btn btn-default"
                       href="{% url 'organizations.views.edit_org' o.id %}">
                        <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                        Edit
                    </a>
                </td>
                <td>
                    <a type="submit" class="btn btn-default"
                       href="{% url 'organizations.views.change_signator_get' o.id %}">
                        <span class="glyphicon glyphicon-sort" aria-hidden="true"></span>
                        Swap Signator
                    </a>
                </td>
                <td>
                    <form method="post"
                          action="{% url 'organizations.views.delete_org' o.id %}">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-default btn-danger">
                            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                            Delete
                        </button>
                    </form>
                </td>
            </tr>
            {% endfor %}
            <tr>
                <td colspan=5><a
		                   href="{% url 'orgs-edit' '' %}">
	                Create an Organization &raquo;
	        </td>
            </tr>
        </table>
	{% else %}
        <p>
            According to our records, you have not yet attended signator
            training. (Signator trainings are usually in the first few weeks of
            school, though the treasurers will sometimes give you an individual
            training later in the school year ðŸ˜Š.)
        </p>
        <p>If you need to get signator training or you have been trained and think
            this is an error, please <a href="mailto:money@lists.reed.edu" target="_top">
                contact the treasurers.</a></p>
	{% endif %}


        
        </div>
      </div>
</div> <!--/.container -->
{% endblock %}
